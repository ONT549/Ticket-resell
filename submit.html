<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<title>í‹°ì¼“ ë“±ë¡</title>
<link href="style.css" rel="stylesheet"/>
<style>
  body {
    font-family: 'Arial', sans-serif;
    background-color: #f9f9f9;
    padding: 40px;
  }
  h1 {
    text-align: center;
    margin-bottom: 30px;
  }
  form {
    max-width: 800px;
    margin: auto;
    background: #fff;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  .form-group {
    display: flex;
    flex-direction: column;
  }
  .form-group.inline {
    flex-direction: row;
    gap: 10px;
    align-items: center;
  }
  label {
    font-weight: bold;
    margin-bottom: 6px;
  }
  input, select, textarea {
    padding: 10px;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    width: 100%;
  }
  input[type="checkbox"] {
    width: auto;
  }
  .checkbox-group {
    display: flex;
    gap: 20px;
    align-items: center;
  }
  button {
    padding: 12px;
    background-color: #007bff;
    border: none;
    color: white;
    font-size: 1rem;
    border-radius: 6px;
    cursor: pointer;
  }
</style></head>
<body>
<h1><a href="index.html" style="text-decoration: none; color: inherit;">ğŸŸï¸ Our Ticket</a></h1>
<nav>
<ul class="nav-links">
<li><a href="submit.html">í‹°ì¼“ ë“±ë¡</a></li>
<li><a href="tickets.html">ë“±ë¡ëœ í‹°ì¼“</a></li>
<li><a href="about.html">ì†Œê°œ</a></li>
<li class="dropdown">
<span class="dropdown-toggle">ìŠ¤í¬ì¸ </span>
<ul class="dropdown-menu">
<li><strong>âš¾ ì•¼êµ¬</strong></li>
<li><a href="baseball/doosan.html">ë‘ì‚° ë² ì–´ìŠ¤</a></li>
<li><a href="baseball/lg.html">LG íŠ¸ìœˆìŠ¤</a></li>
<li><a href="baseball/ktwiz.html">KT wiz</a></li>
<li><a href="baseball/samsung.html">ì‚¼ì„± ë¼ì´ì˜¨ì¦ˆ</a></li>
<li><a href="baseball/ssg.html">SSG ëœë”ìŠ¤</a></li>
<li><a href="baseball/hanwha.html">í•œí™” ì´ê¸€ìŠ¤</a></li>
<li><a href="baseball/nc.html">NC ë‹¤ì´ë…¸ìŠ¤</a></li>
<li><a href="baseball/lotte.html">ë¡¯ë° ìì´ì–¸ì¸ </a></li>
<li><a href="baseball/kiwoom.html">í‚¤ì›€ íˆì–´ë¡œì¦ˆ</a></li>
<li><a href="baseball/kia.html">KIA íƒ€ì´ê±°ì¦ˆ</a></li>
<li><strong>âš½ ì¶•êµ¬</strong></li>
<li><a href="Soccer/fcseoul.html">FC ì„œìš¸</a></li>
<li><a href="Soccer/suwonsamsung.html">ìˆ˜ì› ì‚¼ì„±</a></li>
<li><a href="Soccer/ulsanhyundai.html">ìš¸ì‚° í˜„ëŒ€</a></li>
<li><a href="Soccer/jeonbuk.html">ì „ë¶ í˜„ëŒ€</a></li>
<li><a href="Soccer/pohang.html">í¬í•­ ìŠ¤í‹¸ëŸ¬ìŠ¤</a></li>
<li><a href="Soccer/daegu.html">ëŒ€êµ¬ FC</a></li>
<li><a href="Soccer/gwangju.html">ê´‘ì£¼ FC</a></li>
<li><a href="Soccer/jeju.html">ì œì£¼ ìœ ë‚˜ì´í‹°ë“œ</a></li>
<li><a href="Soccer/incheon.html">ì¸ì²œ ìœ ë‚˜ì´í‹°ë“œ</a></li>
<li><a href="Soccer/gangwon.html">ê°•ì› FC</a></li>
</ul>
</li>
</ul>
</nav>
<form id="ticketForm"><div class="form-group"><label for="sport_type">ì¢…ëª©:</label></div><div class="form-group"><select id="sport_type" name="sport_type">
<option value="">-- ì¢…ëª©ì„ ì„ íƒí•˜ì„¸ìš” --</option>
<option value="ì•¼êµ¬">ì•¼êµ¬</option>
<option value="ì¶•êµ¬">ì¶•êµ¬</option>
</select></div><div class="form-group"><label for="team">íŒ€:</label></div><div class="form-group"><select id="team" name="team"></select></div><div class="form-group"><label>ê²½ê¸°ì¥:</label></div><div class="form-group"><select id="stadium_select" name="stadium_select" style="display:none;"></select></div><div class="form-group"><input id="stadium_input" name="stadium_input" placeholder="ê²½ê¸°ì¥ì„ ì…ë ¥í•˜ì„¸ìš”" style="display:none;" type="text"/></div><div class="form-group"><label for="match_date">ê²½ê¸° ë‚ ì§œ:</label></div><div class="form-group"><input id="match_date" name="match_date" type="date"/></div><div class="form-group"><label for="match_time">ê²½ê¸° ì‹œê°„:</label></div><div class="form-group"><input id="match_time" name="match_time" type="time"/></div>
<div class="form-row" id="seat-info-group" style="display: flex; gap: 20px;">
<div class="form-group">
<label for="opponent_team">ìƒëŒ€íŒ€ ì„ íƒ</label>
<select id="opponent_team" name="opponent_team"></select>
</div>
<div class="form-group">
<label for="seat_grade">ì¢Œì„ ì„ íƒ</label>
<select id="seat_grade" name="seat_grade"></select>
</div>
<div class="form-group">
<label for="section">êµ¬ì—­(ì¡´/ë¸”ëŸ­)</label>
<input id="section" name="section" type="text"/>
</div>
<div class="form-group">
<label for="row">ì—´</label>
<input id="row" name="row" type="text"/>
</div>
</div>
<div class="form-group"><label for="trade_method">ê±°ë˜ ë°©ì‹:</label></div><div class="form-group"><select id="trade_method" name="trade_method" required="">
<option value="">-- ê±°ë˜ ë°©ì‹ì„ ì„ íƒí•˜ì„¸ìš” --</option>
<option value="ë°°ì†¡">ë°°ì†¡</option>
<option value="í˜„ì¥">í˜„ì¥</option>
<option value="PIN(E-ticket)">PIN(E-ticket)</option>
<option value="ê¸°íƒ€">ê¸°íƒ€</option>
</select></div>
<div class="form-row">
<div class="form-group">
<label for="ticket_count">ì „ì²´ ìˆ˜ëŸ‰</label>
<input id="ticket_count" name="ticket_count" required="" type="number"/>
</div>
<div class="form-group">
<label for="price">1ë§¤ë‹¹ ê°€ê²© (ì›)</label>
<input id="price" name="price" required="" step="100" type="number"/>
</div>
</div>
<div class="form-row checkbox-group">
<label><input id="is_adjacent" name="is_adjacent" type="checkbox"/> ì—°ì„</label>
<label><input id="is_under_price" name="is_under_price" type="checkbox"/> ì •ê°€ ì´í•˜ íŒë§¤ (ìˆ˜ìˆ˜ë£Œ ë¬´ë£Œ)</label>
</div>
<div class="form-group"><label for="trade_description">ê±°ë˜ ì„¤ëª…(í˜„ì¥, ê¸°íƒ€ ì„ íƒ ì‹œì—ë§Œ):</label></div><div class="form-group"><textarea id="trade_description" name="trade_description" placeholder="ìƒí’ˆ ë° ê±°ë˜ ë°©ë²•ì— ëŒ€í•œ ì„¤ëª… ì…ë ¥ (ìµœëŒ€ 2000ì)"></textarea></div><button type="submit">ë“±ë¡</button></form>
<div id="result"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
  const supabase = window.supabase.createClient(
    'https://dbdnvjbkotlyarsfmtjn.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRiZG52amJrb3RseWFyc2ZtdGpuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY5NTUxNTUsImV4cCI6MjA2MjUzMTE1NX0.cQXd9NQQbEQ5tWAeQ2pJWIoGkQjAbVs4tOQAUeDCET0'
  );
</script>
<script src="stadiumSeats.js"></script>
<script>
updateSeatOptions("stadium_select", "seat_grade");


    const result = document.getElementById('result');

    const sportSelect = document.getElementById('sport_type');
    const teamSelect = document.getElementById('team');
    const stadiumSelect = document.getElementById('stadium_select');
    const stadiumInput = document.getElementById('stadium_input');

    const teams = {
      'ì•¼êµ¬': ['-- íŒ€ì„ ì„ íƒí•˜ì„¸ìš” --', 'ë‘ì‚° ë² ì–´ìŠ¤', 'LG íŠ¸ìœˆìŠ¤', 'KT wiz', 'ì‚¼ì„± ë¼ì´ì˜¨ì¦ˆ', 'SSG ëœë”ìŠ¤', 'í•œí™” ì´ê¸€ìŠ¤', 'NC ë‹¤ì´ë…¸ìŠ¤', 'ë¡¯ë° ìì´ì–¸ì¸ ', 'í‚¤ì›€ íˆì–´ë¡œì¦ˆ', 'KIA íƒ€ì´ê±°ì¦ˆ'],
      'ì¶•êµ¬': ['-- íŒ€ì„ ì„ íƒí•˜ì„¸ìš” --', 'FC ì„œìš¸', 'ìˆ˜ì› ì‚¼ì„±', 'ìš¸ì‚° í˜„ëŒ€', 'ì „ë¶ í˜„ëŒ€', 'í¬í•­ ìŠ¤í‹¸ëŸ¬ìŠ¤', 'ëŒ€êµ¬ FC', 'ê´‘ì£¼ FC', 'ì œì£¼ ìœ ë‚˜ì´í‹°ë“œ', 'ì¸ì²œ ìœ ë‚˜ì´í‹°ë“œ', 'ê°•ì› FC']
    };

    const stadiums = {
      'ë‘ì‚° ë² ì–´ìŠ¤': ['-- ê²½ê¸°ì¥ì„ ì„ íƒí•˜ì„¸ìš” --', 'ì ì‹¤ì•¼êµ¬ì¥(ì£¼ì¤‘)', 'ì ì‹¤ì•¼êµ¬ì¥(ê¸ˆí† ì¼/ê³µíœ´ì¼)'],
      'LG íŠ¸ìœˆìŠ¤': ['-- ê²½ê¸°ì¥ì„ ì„ íƒí•˜ì„¸ìš” --', 'ì ì‹¤ì•¼êµ¬ì¥(ì£¼ì¤‘)', 'ì ì‹¤ì•¼êµ¬ì¥(ê¸ˆí† ì¼/ê³µíœ´ì¼)'],
      'KT wiz': ['-- ê²½ê¸°ì¥ì„ ì„ íƒí•˜ì„¸ìš” --', 'ìˆ˜ì› ìœ„ì¦ˆ íŒŒí¬(ì£¼ì¤‘)', 'ìˆ˜ì› ìœ„ì¦ˆ íŒŒí¬(ê¸ˆí† ì¼/ê³µíœ´ì¼)'],
      'ì‚¼ì„± ë¼ì´ì˜¨ì¦ˆ': ['-- ê²½ê¸°ì¥ì„ ì„ íƒí•˜ì„¸ìš” --', 'ëŒ€êµ¬ ë¼ì´ì˜¨ì¦ˆ íŒŒí¬(ì£¼ì¤‘)', 'ëŒ€êµ¬ ë¼ì´ì˜¨ì¦ˆ íŒŒí¬(ê¸ˆí† ì¼/ê³µíœ´ì¼)', 'í¬í•­ ì•¼êµ¬ì¥'],
      'SSG ëœë”ìŠ¤': ['-- ê²½ê¸°ì¥ì„ ì„ íƒí•˜ì„¸ìš” --', 'ì¸ì²œ SSG ëœë”ìŠ¤í•„ë“œ(ì£¼ì¤‘)', 'ì¸ì²œ SSG ëœë”ìŠ¤í•„ë“œ(ê¸ˆí† ì¼/ê³µíœ´ì¼)'],
      'í•œí™” ì´ê¸€ìŠ¤': ['-- ê²½ê¸°ì¥ì„ ì„ íƒí•˜ì„¸ìš” --', 'ëŒ€ì „ í•œí™”ìƒëª… ë³¼íŒŒí¬(ì£¼ì¤‘)', 'ëŒ€ì „ í•œí™”ìƒëª… ë³¼íŒŒí¬(ê¸ˆí† ì¼/ê³µíœ´ì¼)', 'ì²­ì£¼ ì•¼êµ¬ì¥'],
      'NC ë‹¤ì´ë…¸ìŠ¤': ['-- ê²½ê¸°ì¥ì„ ì„ íƒí•˜ì„¸ìš” --', 'ìš¸ì‚° ë¬¸ìˆ˜ ì•¼êµ¬ì¥(ì£¼ì¤‘)', 'ìš¸ì‚° ë¬¸ìˆ˜ ì•¼êµ¬ì¥(ê¸ˆí† ì¼/ê³µíœ´ì¼)', 'ì°½ì› NC íŒŒí¬'],
      'ë¡¯ë° ìì´ì–¸ì¸ ': ['-- ê²½ê¸°ì¥ì„ ì„ íƒí•˜ì„¸ìš” --', 'ë¶€ì‚° ì‚¬ì§ ì•¼êµ¬ì¥(ì£¼ì¤‘)', 'ë¶€ì‚° ì‚¬ì§ ì•¼êµ¬ì¥(ê¸ˆí† ì¼/ê³µíœ´ì¼)', 'ìš¸ì‚° ë¬¸ìˆ˜ ì•¼êµ¬ì¥'],
      'í‚¤ì›€ íˆì–´ë¡œì¦ˆ': ['-- ê²½ê¸°ì¥ì„ ì„ íƒí•˜ì„¸ìš” --', 'ê³ ì²™ ë” ì•¼êµ¬ì¥(ì£¼ì¤‘)', 'ê³ ì²™ ë” ì•¼êµ¬ì¥(ê¸ˆí† ì¼/ê³µíœ´ì¼)'],
      'KIA íƒ€ì´ê±°ì¦ˆ': ['-- ê²½ê¸°ì¥ì„ ì„ íƒí•˜ì„¸ìš” --', 'ê´‘ì£¼ ì±”í”¼ì–¸ìŠ¤ í•„ë“œ(ì£¼ì¤‘)', 'ê´‘ì£¼ ì±”í”¼ì–¸ìŠ¤ í•„ë“œ(ê¸ˆí† ì¼/ê³µíœ´ì¼)']
    };

    sportSelect.addEventListener('change', () => {
      teamSelect.innerHTML = '';
      const sport = sportSelect.value;
      if (teams[sport]) {
        teams[sport].forEach(team => {
          const opt = document.createElement('option');
          opt.value = team;
          opt.textContent = team;
          teamSelect.appendChild(opt);
        });
      }

      if (sport === 'ì•¼êµ¬') {
        stadiumSelect.style.display = 'inline';
        stadiumInput.style.display = 'none';
      } else {
        stadiumSelect.style.display = 'none';
        stadiumInput.style.display = 'inline';
      }
    });

    
const opponentSelect = document.getElementById("opponent_team");

teamSelect.addEventListener('change', () => {
  const team = teamSelect.value;

  // ê¸°ì¡´ stadium ì²˜ë¦¬ ìœ ì§€
  if (stadiums[team]) {
    stadiumSelect.innerHTML = '';
    stadiums[team].forEach(stadium => {
      const opt = document.createElement('option');
      opt.value = stadium;
      opt.textContent = stadium;
      stadiumSelect.appendChild(opt);
    });
    stadiumSelect.style.display = 'inline';
  }

  // ìƒëŒ€íŒ€ í•„í„°ë§
  const sport = sportSelect.value;
  if (teams[sport]) {
    opponentSelect.innerHTML = '';
    teams[sport].forEach(t => {
      if (t !== team && t !== '-- íŒ€ì„ ì„ íƒí•˜ì„¸ìš” --') {
        const opt = document.createElement('option');
        opt.value = t;
        opt.textContent = t;
        opponentSelect.appendChild(opt);
      }
    });
  }
});


teamSelect.addEventListener('change', () => {
      const team = teamSelect.value;
      if (stadiums[team]) {
        stadiumSelect.innerHTML = '';
        stadiums[team].forEach(stadium => {
          const opt = document.createElement('option');
          opt.value = stadium;
          opt.textContent = stadium;
          stadiumSelect.appendChild(opt);
        });
        stadiumSelect.style.display = 'inline';
      }
    });

        const form = document.getElementById('ticketForm');
form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const { data: userData, error: userError } = await supabase.auth.getUser();
      if (userError || !userData.user) {
        result.textContent = 'âŒ ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.';
        return;
      }
      const user_id = userData.user.id;


      const sport_type = sportSelect.value;
      const team = teamSelect.value;
      const stadium = sport_type === 'ì•¼êµ¬' ? stadiumSelect.value : stadiumInput.value;
      const match_date = document.getElementById('match_date').value;
      const opponent_team = document.getElementById('opponent_team').value;
const seat_grade = document.getElementById('seat_grade').value;
console.log("seat_grade:", seat_grade);
if (!seat_grade) {
  result.textContent = 'âŒ ì¢Œì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.';
  return;
}
const match_time = document.getElementById('match_time').value;
      const price = parseInt(document.getElementById('price').value);
      const ticket_count = parseInt(document.getElementById('ticket_count').value);
      
      const trade_method = document.getElementById('trade_method').value;
      const trade_description = document.getElementById('trade_description').value;
      const is_adjacent = document.getElementById('is_adjacent').checked;
      const is_under_price = document.getElementById('is_under_price').checked;
      const section = document.getElementById('section').value;
      const row = document.getElementById('row').value;
      

      const { data, error } = await supabase
        .from('tickets')
        .insert([{
          opponent_team,
          seat_grade,
          sport_type,
          team,
          stadium,
          match_date,
          match_time,
          price,
          ticket_count,
          user_id,
          trade_method,
          trade_description,
          is_adjacent,
          is_under_price,
          section,
          row,
                  }]);

      if (error) {
        console.error(error);
        result.textContent = 'âŒ í‹°ì¼“ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
      } else {
        result.textContent = 'âœ… í‹°ì¼“ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!';
        form.reset();
        stadiumSelect.style.display = 'none';
        stadiumInput.style.display = 'none';
        teamSelect.innerHTML = '';
      }
    });


stadiumSelect.addEventListener("change", () => {
  const seatSelect = document.getElementById("seat_grade");
  const stadiumName = stadiumSelect.value.replace(/\(.*?\)/g, "").trim();
  seatSelect.innerHTML = '';
  if (stadiumSeats[stadiumName]) {
    stadiumSeats[stadiumName].forEach(seat => {
      const opt = document.createElement("option");
      opt.value = seat;
      opt.textContent = seat;
      seatSelect.appendChild(opt);
    });
  } else {
    const opt = document.createElement("option");
    opt.textContent = "ì„ íƒ ê°€ëŠ¥í•œ ì¢Œì„ ì—†ìŒ";
    seatSelect.appendChild(opt);
  }
});
</script>
</body>
</html>
