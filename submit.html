<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<title>티켓 등록</title>
<link href="style.css" rel="stylesheet"/>
<script defer="" src="dropdown.js"></script>
<style>
    .search-container {
      text-align: center;
      margin: 40px auto;
    }

    #searchInput {
      padding: 10px;
      font-size: 16px;
      width: 60%;
      max-width: 400px;
    }

    .search-results {
      margin-top: 20px;
      text-align: center;
    }

    .search-results ul {
      list-style: none;
      padding: 0;
    }

    .search-results li {
      margin: 10px 0;
    }

    .search-results a {
      text-decoration: none;
      color: #0077cc;
      font-weight: bold;
    }

    .search-results a:hover {
      text-decoration: underline;
    }
  
    .button {
      padding: 12px;
      background-color: #007bff;
      border: none;
      color: white;
      font-size: 1rem;
      border-radius: 6px;
      cursor: pointer;
    }

    .h1 {
      text-align: center;
      margin-bottom: 30px;
    }
  
    .form {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
  
    .form-group {
      display: flex;
      flex-direction: column;
    }
  
    .form-group.inline {
      flex-direction: row;
      gap: 10px;
      align-items: center;
    }
  
    .label {
      font-weight: bold;
      margin-bottom: 6px;
    }
  
    .input, select, textarea {
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      width: 100%;
    }
  
    .input[type="checkbox"] {
      width: auto;
    }
  
    .checkbox-group {
      display: flex;
      gap: 20px;
      align-items: center;
    }
  
    .home-logo {
      height: 150px;
      margin: 20px auto;
      display: block;
    }
  </style>
<style>
.dropdown-wrapper {
  margin-top: 2rem;
  position: relative;
  width: fit-content;
}
.dropdown-toggle {
  background-color: white;
  color: #007BFF;
  padding: 0.6rem 1.2rem;
  border: none;
  border-radius: 999px;
  font-weight: bold;
  cursor: pointer;
}
.dropdown-menu {
  display: none;
  position: absolute;
  top: calc(100% + 10px);
  left: 0;
  background-color: white;
  color: #333;
  border-radius: 1rem;
  padding: 1.5rem 2rem;
  box-shadow: 0 12px 32px rgba(0,0,0,0.12);
  z-index: 1000;
  flex-wrap: nowrap;
  gap: 2rem;
  overflow-x: auto;
  min-width: 700px;
  max-width: 95vw;
}
.dropdown-category {
  flex: 0 0 300px;
  color: #333;
}
.dropdown-category ul {
  list-style: none;
  padding-left: 0;
}
.dropdown-category li {
  margin: 0.4rem 0;
}
.dropdown-category a {
  text-decoration: none;
  color: #333 !important;
}
.dropdown-category strong {
  color: #333;
}
.sub-dropdown {
  display: none;
  padding-left: 1rem;
  margin-top: 0.3rem;
}
.sub-dropdown li {
  margin: 0.3rem 0;
}
.sub-dropdown a {
  color: #333 !important;
}
.cta-group{
  display:flex;
  flex-wrap:wrap;          /* 작은 화면 대응 */
  gap:1rem;
  justify-content:center;
  margin-top:1.5rem;
}
.cta-button,
.dropdown-toggle{
  background:#fff;
  color:#007BFF;
  padding:0.6rem 1.2rem;
  border:none;
  border-radius:999px;
  font-weight:bold;
  cursor:pointer;
  text-decoration:none;    /* a, button 통일 */
}
.cta-button:hover,
.dropdown-toggle:hover{
  background:#f0f4ff;
}
.dropdown-wrapper{margin-top:0!important;}
</style></head>
<body>
<a href="login.html" id="login-button" style="position: absolute; top: 20px; right: 20px;
  padding: 10px 16px; background-color: #007BFF; color: white; text-decoration: none; border-radius: 6px;">
  로그인 / 회원가입
</a>
<header>
<a href="index.html">
<img alt="Ticket Zone Logo" class="home-logo" src="cover.png"/>
</a>
<nav>
</nav>
</header>
<main><section class="hero-banner"><h2>실시간 티켓 거래, 믿을 수 있는 Ticket Zone</h2>
    <p>야구/축구 티켓을 쉽고 빠르게 등록하고 양도해보세요.</p>
<div class="cta-group">
  <a class="cta-button" href="submit.html">티켓 등록하러 가기</a>
  <a class="cta-button" href="tickets.html">등록된 티켓</a>
  <a class="cta-button" href="about.html">소개</a>
    <ul class="nav-links"></ul>
<div class="dropdown-wrapper">
 <button class="dropdown-toggle" onclick="toggleDropdown()">스포츠</button>
    <div class="dropdown-menu" id="dropdownMenu">
<div class="dropdown-category">
<strong>⚾ 야구</strong>
<ul>
<li class="team">
<span onclick="toggleSub(this)">두산 베어스 ▾</span>
<ul class="sub-dropdown">
<li><a href="baseball/doosan/doosan_jamsil_weekday.html">잠실야구장(주중)</a></li>
<li><a href="baseball/doosan/doosan_jamsil_weekend.html">잠실야구장(금토일/공휴일)</a></li>
</ul>
</li>
<li class="team">
<span onclick="toggleSub(this)">LG 트윈스 ▾</span>
<ul class="sub-dropdown">
<li><a href="baseball/lg/lg_jamsil_weekday.html">잠실야구장(주중)</a></li>
<li><a href="baseball/lg/lg_jamsil_weekend.html">잠실야구장(금토일/공휴일)</a></li>
</ul>
</li>
<li class="team">
<span onclick="toggleSub(this)">KT wiz ▾</span>
<ul class="sub-dropdown">
<li><a href="baseball/ktwiz/ktwiz_suwon_weekday.html">수원 위즈 파크(주중)</a></li>
<li><a href="baseball/ktwiz/ktwiz_suwon_weekend.html">수원 위즈 파크(금토일/공휴일)</a></li>
</ul>
</li>
<li class="team">
<span onclick="toggleSub(this)">삼성 라이온즈 ▾</span>
<ul class="sub-dropdown">
<li><a href="baseball/samsung/samsung_daegu_weekday.html">대구 라이온즈 파크(주중)</a></li>
<li><a href="baseball/samsung/samsung_daegu_weekend.html">대구 라이온즈 파크(금토일/공휴일)</a></li>
<li><a href="baseball/samsung/samsung_pohang.html">포항 야구장</a></li>
</ul>
</li>
<li class="team">
<span onclick="toggleSub(this)">SSG 랜더스 ▾</span>
<ul class="sub-dropdown">
<li><a href="baseball/ssg/ssg_incheon_weekday.html">인천 SSG 랜더스필드(주중)</a></li>
<li><a href="baseball/ssg/ssg_incheon_weekend.html">인천 SSG 랜더스필드(금토일/공휴일)</a></li>
</ul>
</li>
<li class="team">
<span onclick="toggleSub(this)">한화 이글스 ▾</span>
<ul class="sub-dropdown">
<li><a href="baseball/hanwha/hanwha_daejeon_weekday.html">대전 한화생명 볼파크(주중)</a></li>
<li><a href="baseball/hanwha/hanwha_daejeon_weekend.html">대전 한화생명 볼파크(금토일/공휴일)</a></li>
<li><a href="baseball/hanwha/hanwha_cheongju.html">청주 야구장</a></li>
</ul>
</li>
<li class="team">
<span onclick="toggleSub(this)">NC 다이노스 ▾</span>
<ul class="sub-dropdown">
<li><a href="baseball/nc/nc_ulsan_weekday.html">울산 문수 야구장(주중)</a></li>
<li><a href="baseball/nc/nc_ulsan_weekend.html">울산 문수 야구장(금토일/공휴일)</a></li>
<li><a href="baseball/nc/nc_changwon.html">창원 NC 파크</a></li>
</ul>
</li>
<li class="team">
<span onclick="toggleSub(this)">롯데 자이언츠 ▾</span>
<ul class="sub-dropdown">
<li><a href="baseball/lotte/lotte_busan_weekday.html">부산 사직 야구장(주중)</a></li>
<li><a href="baseball/lotte/lotte_busan_weekend.html">부산 사직 야구장(금토일/공휴일)</a></li>
<li><a href="baseball/lotte/lotte_ulsan.html">울산 문수 야구장</a></li>
</ul>
</li>
<li class="team">
<span onclick="toggleSub(this)">키움 히어로즈 ▾</span>
<ul class="sub-dropdown">
<li><a href="baseball/kiwoom/kiwoom_gocheok_weekday.html">고척 돔 야구장(주중)</a></li>
<li><a href="baseball/kiwoom/kiwoom_gocheok_weekend.html">고척 돔 야구장(금토일/공휴일)</a></li>
</ul>
</li>
<li class="team">
<span onclick="toggleSub(this)">KIA 타이거즈 ▾</span>
<ul class="sub-dropdown">
<li><a href="baseball/kia/kia_gwangju_weekday.html">광주 챔피언스 필드(주중)</a></li>
<li><a href="baseball/kia/kia_gwangju_weekend.html">광주 챔피언스 필드(금토일/공휴일)</a></li>
</ul>
</li>
</ul>
</div>
<div class="dropdown-category">
<strong>⚽ 축구</strong>
<ul>
<li><a href="Soccer/fcseoul.html">FC 서울</a></li>
<li><a href="Soccer/suwonsamsung.html">수원 삼성</a></li>
<li><a href="Soccer/ulsanhyundai.html">울산 현대</a></li>
<li><a href="Soccer/jeonbuk.html">전북 현대</a></li>
<li><a href="Soccer/pohang.html">포항 스틸러스</a></li>
<li><a href="Soccer/daegu.html">대구 FC</a></li>
<li><a href="Soccer/gwangju.html">광주 FC</a></li>
<li><a href="Soccer/jeju.html">제주 유나이티드</a></li>
<li><a href="Soccer/incheon.html">인천 유나이티드</a></li>
<li><a href="Soccer/gangwon.html">강원 FC</a></li>
</ul>
</li>
<style>
          .nav-links li { position: relative; }
          .dropdown-menu, .sub-dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #ccc;
            z-index: 1000;
            white-space: nowrap;
          }
          .dropdown:hover > .dropdown-menu {
            display: block;
          }
          .dropdown-menu li:hover > .sub-dropdown-menu {
            display: block;
            top: 0;
            left: 100%;
          }
          .dropdown-menu li {
            position: relative;
          }
</style>
</ul>
</nav>
<form id="ticketForm"><div class="form-group"><label for="sport_type">종목:</label></div><div class="form-group"><select id="sport_type" name="sport_type">
<option value="">-- 종목을 선택하세요 --</option>
<option value="야구">야구</option>
<option value="축구">축구</option>
</select></div><div class="form-group"><label for="team">팀:</label></div><div class="form-group"><select id="team" name="team"></select></div><div class="form-group"><label>경기장:</label></div><div class="form-group"><select id="stadium_select" name="stadium_select" style="display:none;"></select></div><div class="form-group"><input id="stadium_input" name="stadium_input" placeholder="경기장을 입력하세요" style="display:none;" type="text"/></div><div class="form-group"><label for="match_date">경기 날짜:</label></div><div class="form-group"><input id="match_date" name="match_date" type="date"/></div><div class="form-group"><label for="match_time">경기 시간:</label></div><div class="form-group"><input id="match_time" name="match_time" type="time"/></div>
<div class="form-row" id="seat-info-group" style="display: flex; gap: 20px;">
<div class="form-group">
<label for="opponent_team">상대팀 선택</label>
<select id="opponent_team" name="opponent_team"></select>
</div>
<div class="form-group">
<label for="seat_grade">좌석 선택</label>
<select id="seat_grade" name="seat_grade"></select>
</div>
<div class="form-group">
<label for="section">구역(존/블럭)</label>
<input id="section" name="section" type="text"/>
</div>
<div class="form-group">
<label for="row">열</label>
<input id="row" name="row" type="text"/>
</div>
</div>
<div class="form-group"><label for="trade_method">거래 방식:</label></div><div class="form-group"><select id="trade_method" name="trade_method" required="">
<option value="">-- 거래 방식을 선택하세요 --</option>
<option value="배송">배송</option>
<option value="현장">현장</option>
<option value="PIN(E-ticket)">PIN(E-ticket)</option>
<option value="기타">기타</option>
</select></div>
<div class="form-row">
<div class="form-group">
<label for="ticket_count">전체 수량</label>
<input id="ticket_count" name="ticket_count" required="" type="number"/>
</div>
<div class="form-group">
<label for="price">1매당 가격 (원)</label>
<input id="price" name="price" required="" step="100" type="number"/>
</div>
</div>
<div class="form-row checkbox-group">
<label><input id="is_adjacent" name="is_adjacent" type="checkbox"/> 연석</label>
<label><input id="is_under_price" name="is_under_price" type="checkbox"/> 정가 이하 판매 (수수료 무료)</label>
</div>
<div class="form-group"><label for="trade_description">거래 설명(현장, 기타 선택 시에만):</label></div><div class="form-group"><textarea id="trade_description" name="trade_description" placeholder="상품 및 거래 방법에 대한 설명 입력 (최대 2000자)"></textarea></div><button type="submit">등록</button></form>
<div id="result"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
  const supabase = window.supabase.createClient(
    'https://dbdnvjbkotlyarsfmtjn.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRiZG52amJrb3RseWFyc2ZtdGpuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY5NTUxNTUsImV4cCI6MjA2MjUzMTE1NX0.cQXd9NQQbEQ5tWAeQ2pJWIoGkQjAbVs4tOQAUeDCET0'
  );
</script>
<script src="stadiumSeats.js"></script>
<script>
updateSeatOptions("stadium_select", "seat_grade");


    const result = document.getElementById('result');

    const sportSelect = document.getElementById('sport_type');
    const teamSelect = document.getElementById('team');
    const stadiumSelect = document.getElementById('stadium_select');
    const stadiumInput = document.getElementById('stadium_input');

    const teams = {
      '야구': ['-- 팀을 선택하세요 --', '두산 베어스', 'LG 트윈스', 'KT wiz', '삼성 라이온즈', 'SSG 랜더스', '한화 이글스', 'NC 다이노스', '롯데 자이언츠', '키움 히어로즈', 'KIA 타이거즈'],
      '축구': ['-- 팀을 선택하세요 --', 'FC 서울', '수원 삼성', '울산 현대', '전북 현대', '포항 스틸러스', '대구 FC', '광주 FC', '제주 유나이티드', '인천 유나이티드', '강원 FC']
    };

    const stadiums = {
      '두산 베어스': ['-- 경기장을 선택하세요 --', '잠실야구장(주중)', '잠실야구장(금토일/공휴일)'],
      'LG 트윈스': ['-- 경기장을 선택하세요 --', '잠실야구장(주중)', '잠실야구장(금토일/공휴일)'],
      'KT wiz': ['-- 경기장을 선택하세요 --', '수원 위즈 파크(주중)', '수원 위즈 파크(금토일/공휴일)'],
      '삼성 라이온즈': ['-- 경기장을 선택하세요 --', '대구 라이온즈 파크(주중)', '대구 라이온즈 파크(금토일/공휴일)', '포항 야구장'],
      'SSG 랜더스': ['-- 경기장을 선택하세요 --', '인천 SSG 랜더스필드(주중)', '인천 SSG 랜더스필드(금토일/공휴일)'],
      '한화 이글스': ['-- 경기장을 선택하세요 --', '대전 한화생명 볼파크(주중)', '대전 한화생명 볼파크(금토일/공휴일)', '청주 야구장'],
      'NC 다이노스': ['-- 경기장을 선택하세요 --', '울산 문수 야구장(주중)', '울산 문수 야구장(금토일/공휴일)', '창원 NC 파크'],
      '롯데 자이언츠': ['-- 경기장을 선택하세요 --', '부산 사직 야구장(주중)', '부산 사직 야구장(금토일/공휴일)', '울산 문수 야구장'],
      '키움 히어로즈': ['-- 경기장을 선택하세요 --', '고척 돔 야구장(주중)', '고척 돔 야구장(금토일/공휴일)'],
      'KIA 타이거즈': ['-- 경기장을 선택하세요 --', '광주 챔피언스 필드(주중)', '광주 챔피언스 필드(금토일/공휴일)']
    };

    sportSelect.addEventListener('change', () => {
      teamSelect.innerHTML = '';
      const sport = sportSelect.value;
      if (teams[sport]) {
        teams[sport].forEach(team => {
          const opt = document.createElement('option');
          opt.value = team;
          opt.textContent = team;
          teamSelect.appendChild(opt);
        });
      }

      if (sport === '야구') {
        stadiumSelect.style.display = 'inline';
        stadiumInput.style.display = 'none';
      } else {
        stadiumSelect.style.display = 'none';
        stadiumInput.style.display = 'inline';
      }
    });

    
const opponentSelect = document.getElementById("opponent_team");

teamSelect.addEventListener('change', () => {
  const team = teamSelect.value;

  // 기존 stadium 처리 유지
  if (stadiums[team]) {
    stadiumSelect.innerHTML = '';
    stadiums[team].forEach(stadium => {
      const opt = document.createElement('option');
      opt.value = stadium;
      opt.textContent = stadium;
      stadiumSelect.appendChild(opt);
    });
    stadiumSelect.style.display = 'inline';
  }

  // 상대팀 필터링
  const sport = sportSelect.value;
  if (teams[sport]) {
    opponentSelect.innerHTML = '';
    teams[sport].forEach(t => {
      if (t !== team && t !== '-- 팀을 선택하세요 --') {
        const opt = document.createElement('option');
        opt.value = t;
        opt.textContent = t;
        opponentSelect.appendChild(opt);
      }
    });
  }
});


teamSelect.addEventListener('change', () => {
      const team = teamSelect.value;
      if (stadiums[team]) {
        stadiumSelect.innerHTML = '';
        stadiums[team].forEach(stadium => {
          const opt = document.createElement('option');
          opt.value = stadium;
          opt.textContent = stadium;
          stadiumSelect.appendChild(opt);
        });
        stadiumSelect.style.display = 'inline';
      }
    });

        const form = document.getElementById('ticketForm');
form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const { data: userData, error: userError } = await supabase.auth.getUser();
      if (userError || !userData.user) {
        result.textContent = '❌ 로그인 후 이용해주세요.';
        return;
      }
      const user_id = userData.user.id;
      const user_email = userData.user.email;
      // ✅ 계좌 등록 여부 확인
      const { data: account, error: accountError } = await supabase
        .from("accounts")
        .select("*")
        .eq("user_id", user_id)
        .maybeSingle();

      if (!account || accountError) {
        result.textContent = '❌ 티켓 등록을 위해 계좌 등록이 필요합니다. 마이페이지에서 등록해주세요.';
        return;
      }



      const sport_type = sportSelect.value;
      const team = teamSelect.value;
      const stadium = sport_type === '야구' ? stadiumSelect.value : stadiumInput.value;
      const match_date = document.getElementById('match_date').value;
      const opponent_team = document.getElementById('opponent_team').value;
const seat_grade = document.getElementById('seat_grade').value;
console.log("seat_grade:", seat_grade);
if (!seat_grade) {
  result.textContent = '❌ 좌석을 선택해주세요.';
  return;
}
const match_time = document.getElementById('match_time').value;
      const price = parseInt(document.getElementById('price').value);
      const ticket_count = parseInt(document.getElementById('ticket_count').value);
      
      const trade_method = document.getElementById('trade_method').value;
      const trade_description = document.getElementById('trade_description').value;
      const is_adjacent = document.getElementById('is_adjacent').checked;
      const is_under_price = document.getElementById('is_under_price').checked;
      const section = document.getElementById('section').value;
      const row = document.getElementById('row').value;
      

      const { data, error } = await supabase
        .from('tickets')
        .insert([{
          opponent_team,
          seat_grade,
          sport_type,
          team,
          stadium,
          match_date,
          match_time,
          price,
          ticket_count,
          user_id,
          user_email,
          trade_method,
          trade_description,
          is_adjacent,
          is_under_price,
          section,
          row,
                  }]);

      if (error) {
        console.error(error);
        result.textContent = '❌ 티켓 등록 중 오류가 발생했습니다.';
      } else {
        result.textContent = '✅ 티켓이 성공적으로 등록되었습니다!';
        form.reset();
        stadiumSelect.style.display = 'none';
        stadiumInput.style.display = 'none';
        teamSelect.innerHTML = '';
      }
    });


stadiumSelect.addEventListener("change", () => {
  const seatSelect = document.getElementById("seat_grade");
  const stadiumName = stadiumSelect.value.replace(/\(.*?\)/g, "").trim();
  seatSelect.innerHTML = '';
  if (stadiumSeats[stadiumName]) {
    stadiumSeats[stadiumName].forEach(seat => {
      const opt = document.createElement("option");
      opt.value = seat;
      opt.textContent = seat;
      seatSelect.appendChild(opt);
    });
  } else {
    const opt = document.createElement("option");
    opt.textContent = "선택 가능한 좌석 없음";
    seatSelect.appendChild(opt);
  }
});
</script>
</body>
</html>
